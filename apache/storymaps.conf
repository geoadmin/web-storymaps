RewriteEngine  on


# Enabling CORS
Header set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS"
Header always set Access-Control-Allow-Headers "x-requested-with, Content-Type, origin, authorization, accept, client-security-token"



# End of life

RewriteRule ^/storymaps/storymap3(.*)  - [L,R=404]
RewriteRule ^/storymaps/storymap4(.*)  - [L,R=404]
RewriteRule ^/storymaps/storymap5(.*)  - [L,R=404]
RewriteRule ^/storymaps/storymap9(.*)  - [L,R=404]
RewriteRule ^/storymaps/storymap10(.*)  - [L,R=404]
RewriteRule ^/storymaps/storymap12(.*)  - [L,R=404]
RewriteRule ^/storymaps/storymap13(.*)  - [L,R=404]
RewriteRule ^/storymaps/storymap14(.*)  - [L,R=404]




RedirectMatch ^/$ http://www.geo.admin.ch/de/thematic-geoportals-federal-offices/storymaps-telling-stories-with-geodata.html


# Redirect storymap2 
#
RewriteCond %{REQUEST_URI} ^/storymaps/storymap2(?![0-9])(.*)  [NC]
RewriteCond %{QUERY_STRING} lang=(de|fr|it|en|rm)      [NC]
RewriteRule ^(.*)  http://map.geo.admin.ch/?layers=KML||http://storymaps.geo.admin.ch/storymaps/data/cities_%1.kml&lang=%1  [L]

RewriteCond %{REQUEST_URI} ^/storymaps/storymap2(?![0-9])(.*)  [NC]
RewriteRule ^(.*)  http://map.geo.admin.ch/?layers=KML||http://storymaps.geo.admin.ch/storymaps/data/cities_de.kml&lang=de  [L]


# # Old storymap1, should not match storymap10, etc.
RewriteCond %{REQUEST_URI} ^/storymaps/storymap1(?![0-9])(.*)  [NC]
RewriteCond %{QUERY_STRING} lang=(de|fr|it|en|rm)      [NC]
RewriteRule ^(.*)  http://map.geo.admin.ch/?X=142373.00&Y=791833.15&zoom=6&bgLayer=ch.swisstopo.swissimage&swipe_ratio=0.46&layers=ch.swisstopo.hiks-siegfried&lang=%1  [L]

RewriteCond %{REQUEST_URI} ^/storymaps/storymap1(?![0-9])(.*)  [NC]
RewriteRule ^(.*)  http://map.geo.admin.ch/?X=142373.00&Y=791833.15&zoom=6&bgLayer=ch.swisstopo.swissimage&swipe_ratio=0.46&layers=ch.swisstopo.hiks-siegfried&lang=de  [L]

# Randa
RewriteCond %{REQUEST_URI} ^/storymaps/storymap6(?![0-9])(.*)  [NC]
RewriteCond %{QUERY_STRING} lang=(de|fr|it|en|rm)      [NC]
RewriteRule ^(.*)  http://map.geo.admin.ch/?X=106847.00&Y=626478.25&zoom=8&bgLayer=ch.swisstopo.pixelkarte-farbe&swipe_ratio=0.47&layers=ch.swisstopo.geologie-geotope,ch.swisstopo.hiks-siegfried&lang=%1  [L]

RewriteCond %{REQUEST_URI} ^/storymaps/storymap6(?![0-9])(.*)  [NC]
RewriteRule ^(.*)  http://map.geo.admin.ch/?X=106847.00&Y=626478.25&zoom=8&bgLayer=ch.swisstopo.pixelkarte-farbe&swipe_ratio=0.47&layers=ch.swisstopo.geologie-geotope,ch.swisstopo.hiks-siegfried&lang=de  [L]

# storymap8 (seilbahn)
RewriteCond %{REQUEST_URI} ^/storymaps/storymap8(?![0-9])(.*)  [NC]
RewriteCond %{QUERY_STRING} lang=(de|fr|it|en)      [NC]
RewriteRule ^(.*)  /storymaps/pdf/Storymap_Seilbahn_PDF_%1.pdf  [R,L]

RewriteCond %{REQUEST_URI} ^/storymaps/storymap8(?![0-9])(.*)  [NC]
RewriteRule ^(.*)  /storymaps/pdf/Storymap_Seilbahn_PDF_de.pdf  [R,L]




# SwissGuesser, not hosted here
RewriteRule ^/storymaps/storymap5(.*) http://mf-swissguesser.prod.bgdi.ch/main/storymaps/storymap5$1  [P,L,QSA]  
#RewriteRule ^/storymaps/storymap8(.*) http://mf-swissguesser.prod.bgdi.ch/main/storymaps/storymap8$1  [P,L,QSA]  
RewriteRule ^/storymaps/storymap9(.*) http://mf-swissguesser.prod.bgdi.ch/main/storymaps/storymap9$1  [P,L,QSA]  
RewriteRule ^/storymaps/storymap10(.*) http://mf-swissguesser.prod.bgdi.ch/main/storymaps/storymap10$1  [P,L,QSA]  

RewriteRule ^/storymaps/(images/social|libs|scripts|styles|fonts|images)/(.*) http://mf-swissguesser.prod.bgdi.ch/main/storymaps/$1/$2  [P,L,QSA]


RewriteRule /storymaps(.*)    /var/www/vhosts/web-storymaps/private/storymaps/htdocs$1

ScriptAlias /cgi-bin/  /var/www/vhosts/web-storymaps/cgi-bin/


# 1 week
<FilesMatch "\.(jpg|jpeg|png|gif|swf)$">
 Header set Cache-Control "max-age=604800, public"
</FilesMatch>
  
# 3 hours
<FilesMatch "\.(txt|xml|js|css|geojson|json)$">
  Header set Cache-Control "max-age=10800"
</FilesMatch>
   
# never cache
<FilesMatch "\.(html|cgi)$">
   Header set Cache-Control "max-age=0, private, no-store, no-cache, must-revalidate"
</FilesMatch>

<LocationMatch ^/storymaps/(.*)>
   Order allow,deny
   Allow from all
</LocationMatch>
